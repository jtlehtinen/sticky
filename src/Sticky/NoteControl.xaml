<UserControl
  x:Class="Sticky.NoteControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="clr-namespace:Sticky"
>
  <!-- Double Click Opens Note -->
  <UserControl.InputBindings>
    <MouseBinding
      MouseAction="LeftDoubleClick"
      Command="{x:Static local:Commands.OpenNote}"
      CommandParameter="{Binding Id}"
    />
  </UserControl.InputBindings>

  <UserControl.CommandBindings>
    <CommandBinding Command="{x:Static local:Commands.OpenContextMenu}" Executed="OnOpenContextMenu"/>
  </UserControl.CommandBindings>

  <Border x:Name="OuterBorder" BorderThickness="1" BorderBrush="Gray" CornerRadius="5">
    <Border.Style>
      <Style TargetType="{x:Type Border}">
        <Setter Property="Background" Value="{DynamicResource Background}"/>
        <Style.Triggers>
          <DataTrigger Binding="{Binding ElementName=OuterBorder, Path=IsMouseOver}" Value="True">
            <Setter Property="Background" Value="{DynamicResource BackgroundHover}"/>
          </DataTrigger>
        </Style.Triggers>
      </Style>
    </Border.Style>

    <StackPanel Orientation="Vertical">

      <!-- Top-Right Controls -->
      <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Height="23">
        <local:ButtonEx
          ToolTip="Menu"
          Content="&#xE712;"
          HorizontalAlignment="Right"
          VerticalContentAlignment="Bottom"
          VerticalAlignment="Bottom"
          Width="32"
          Height="23"
          FontSize="16"
          BackgroundColor="Transparent"
          Foreground="{DynamicResource ForegroundSecondary}"
          Visibility="{Binding ElementName=OuterBorder, Path=IsMouseOver, Converter={StaticResource BooleanToVisibilityConverter}}"
          Command="local:Commands.OpenContextMenu"
        />

        <TextBlock
          FontSize="10"
          VerticalAlignment="Bottom"
          HorizontalAlignment="Center"
          Foreground="{DynamicResource ForegroundSecondary}"
          Margin="0,0,10,0"
          Text="{Binding Path=CreatedAt, Converter={StaticResource DateTimeConverter}}"
          Visibility="{Binding ElementName=OuterBorder, Path=IsMouseOver, Converter={StaticResource ReverseBooleanToVisibilityConverter}}"
        />
      </StackPanel>

      <StackPanel Margin="10,0,10,15">
        <local:BindableRichTextBox
          x:Name="NoteRichTextBox"
          Margin="0"
          Cursor="Arrow"
          Focusable="True"
          Background="Transparent"
          BorderBrush="Transparent"
          BorderThickness="0"
          IsReadOnly="True"
          VerticalScrollBarVisibility="Auto"
          HorizontalScrollBarVisibility="Auto"
          Foreground="{DynamicResource Foreground}"
          FontSize="14"
          Document="{Binding Path=Content, Converter={StaticResource StringToFlowDocumentConverter}}"
        >
          <local:BindableRichTextBox.InputBindings>
            <MouseBinding
              MouseAction="LeftDoubleClick"
              Command="{x:Static local:Commands.OpenNote}"
              CommandParameter="{Binding Id}"
            />
          </local:BindableRichTextBox.InputBindings>

          <local:BindableRichTextBox.Resources>
            <Style TargetType="{x:Type Paragraph}">
              <Setter Property="Margin" Value="0"/>
            </Style>
          </local:BindableRichTextBox.Resources>

          <!-- Context Menu -->
          <local:BindableRichTextBox.ContextMenu>
            <ContextMenu>
              <!-- Open Note -->
              <MenuItem
                Header="Open note"
                Command="local:Commands.OpenNote"
                CommandParameter="{Binding Path=Id}"
                Visibility="{Binding Path=Open, Converter={StaticResource ReverseBooleanToVisibilityConverter}}"
              >
                <MenuItem.Icon>
                  <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8A7;"/>
                </MenuItem.Icon>
              </MenuItem>

              <!-- Close Note -->
              <MenuItem
                Header="Close note"
                Command="local:Commands.CloseNote"
                CommandParameter="{Binding Path=Id}"
                Visibility="{Binding Path=Open, Converter={StaticResource BooleanToVisibilityConverter}}"
              >
                <MenuItem.Icon>
                  <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE73F;"/>
                </MenuItem.Icon>
              </MenuItem>

              <!-- Delete -->
              <MenuItem
                Header="Delete note"
                Command="local:Commands.DeleteNote"
                CommandParameter="{Binding Path=Id}"
              >
                <MenuItem.Icon>
                  <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE74D;"/>
                </MenuItem.Icon>
              </MenuItem>
            </ContextMenu>
          </local:BindableRichTextBox.ContextMenu>
        </local:BindableRichTextBox>
      </StackPanel>
    </StackPanel>
  </Border>
</UserControl>
